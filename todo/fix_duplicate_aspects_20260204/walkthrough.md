# 树结构组装逻辑优化 (多父节点支持)

## 问题描述
用户反馈 Power 功能树 (`===`) 与 Process 功能树逻辑不一致，表现为 Power 树中如果存在多个对象拥有相同的“容器编码”（例如 `===DY1.` 同时被 "AH2" 和 "1回路" 占用），系统只会选择其中一个作为父节点，导致另一个节点看似没有子级或者“隐身”。

这本质上是数据中存在重复编码导致的冲突（Collision）。

## 修复方案
修改了 Node.js 后端 (`server/routes/rds.js`) 的树组装逻辑：

1.  **多父节点映射**：现在 `nodeMap` 不再是简单的 `Code -> Node`（一对一），而是 `Code -> [Node1, Node2]`（一对多）。
2.  **子节点分发**：当一个子节点寻找父级（例如寻找 `===DY1.`）时，系统会将其挂载到**所有**拥有该编码的父对象上。
3.  **克隆机制**：为了防止前端 UI 因 ID 重复报错，挂载到第二个及后续父节点时，子节点会被自动克隆并赋予新的临时 ID。

## 验证步骤

### 1. 确保代码生效
- 如果您是在本地运行 server (`npm run dev`)，代码会自动热重载，无需重启。
- 如果是 Docker 环境运行 server，需重建 server 镜像。

### 2. 刷新页面
- 刷新浏览器页面。
- 打开 **RDS 面板 -> 电源 (Power)**。
- 展开 "10KV进线"。

### 3. 预期结果
- 您应该能看到 **"AH2柜出线"** 和 **"1回路主进线"** 并列显示（这在之前也是如此）。
- **关键变化**：如果您之前发现 "1回路" 有子节点而 "AH2" 没有，现在它们应该**都会显示子节点**（如果您的数据定义确实如此）。或者之前被隐藏的节点现在应该出现了。
- 系统不再“随机”二选一，而是展示所有可能的关系。

> [!NOTE]
> 这虽然解决了显示问题，但根源在于 Excel 数据中 "AH2" 和 "1回路" 这两个物理上不同的柜子使用了完全相同的 RDS 编码 (`===DY1.`)。长远建议修正 Excel 数据，使每个柜子有唯一的 RDS 编码（如 `===DY1.AH2`）。
