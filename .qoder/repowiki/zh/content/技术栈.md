# 技术栈

<cite>
**本文档引用的文件**
- [package.json](file://package.json)
- [server/package.json](file://server/package.json)
- [vite.config.js](file://vite.config.js)
- [docker-compose.yml](file://docker-compose.yml)
- [src/main.js](file://src/main.js)
- [src/i18n/index.js](file://src/i18n/index.js)
- [src/services/influx.ts](file://src/services/influx.ts)
- [src/services/postgres.js](file://src/services/postgres.js)
- [server/index.js](file://server/index.js)
- [server/db/index.js](file://server/db/index.js)
- [server/routes/api.js](file://server/routes/api.js)
- [src/App.vue](file://src/App.vue)
- [src/components/MainView.vue](file://src/components/MainView.vue)
</cite>

## 目录
1. [前端技术栈](#前端技术栈)
2. [后端技术栈](#后端技术栈)
3. [关键依赖与功能模块](#关键依赖与功能模块)
4. [部署与开发配置](#部署与开发配置)

## 前端技术栈

tandem-demo项目的前端部分采用了现代化的Vue 3框架与Vite构建工具，构建了一个高效、响应式的单页应用（SPA）。

**Vue 3** 作为核心前端框架，项目利用了其 `<script setup>` 语法糖来简化组件的编写，提高了开发效率和代码的可读性。Vue 3的组合式API（Composition API）使得状态管理和逻辑复用更加灵活，特别适合处理项目中复杂的3D模型交互和数据流。项目中的主要组件，如 `App.vue` 和 `MainView.vue`，都使用了这种现代语法，实现了清晰的逻辑分层和高效的UI更新。

**Vite** 作为构建工具，为项目提供了闪电般的开发服务器启动速度和即时的热模块替换（HMR）。其配置文件 `vite.config.js` 定义了关键的开发代理规则，将 `/api` 前缀的请求代理到后端Express服务器（`http://localhost:3001`），将 `/influx` 前缀的请求代理到InfluxDB时序数据库（`http://localhost:8086`），并重写了路径以去除 `/influx` 前缀。这种配置解决了开发环境下的跨域问题，使前端能够无缝地与后端服务和数据库进行通信。

**Section sources**
- [package.json](file://package.json#L22-L23)
- [vite.config.js](file://vite.config.js#L7-L17)

## 后端技术栈

后端服务基于 **Express** 框架构建，提供了一个轻量级且高效的RESTful API，用于处理前端的请求并与数据库交互。

**Express** 框架在 `server/index.js` 中被初始化，配置了CORS（跨域资源共享）中间件以允许来自前端开发服务器的请求，并设置了JSON和URL编码的解析器。API路由被清晰地组织在 `server/routes/` 目录下，如 `api.js` 和 `timeseries.js`，实现了模块化的路由管理。例如，`/api/assets` 和 `/api/spaces` 等端点用于获取和管理资产与空间数据。

项目集成了两种数据库：**PostgreSQL** 关系型数据库和 **InfluxDB** 时序数据库。PostgreSQL 通过 `pg` 客户端库连接，用于持久化存储结构化的资产、空间和分类信息。数据库连接池在 `server/db/index.js` 中配置，确保了数据库操作的高效性和稳定性。InfluxDB 则通过HTTP API直接与前端交互，专门用于存储和查询随时间变化的温度等时序数据，其配置在前端的 `influx.ts` 文件中定义。

**Section sources**
- [server/package.json](file://server/package.json#L17)
- [server/index.js](file://server/index.js#L5-L14)
- [server/db/index.js](file://server/db/index.js#L5)
- [src/services/influx.ts](file://src/services/influx.ts#L1-L4)

## 关键依赖与功能模块

项目依赖多个关键库来实现其核心功能。

**@photo-sphere-viewer/core** 是一个用于展示360°全景图和3D模型的JavaScript库。在 `MainView.vue` 组件中，它被用来加载和渲染BIM模型。通过 `Autodesk.Viewing.GuiViewer3D` 初始化Viewer，并通过 `loadModel` 方法加载位于 `/models/my-building/output/3d.svf` 的SVF模型文件。Viewer的初始化会根据系统语言（通过 `vue-i18n` 获取）自动设置为中文或英文界面。

**vue-i18n** 是Vue的国际化插件，用于实现多语言支持。在 `src/i18n/index.js` 中，定义了包含中文（`zh`）和英文（`en`）的 `messages` 对象，涵盖了应用中所有用户界面的文本，如按钮、标签和提示信息。应用启动时，会从 `localStorage` 中读取用户的语言偏好，或使用默认的中文。`App.vue` 组件通过 `createApp(App).use(i18n)` 将其注入到Vue应用中，使得所有组件都可以通过 `$t('key')` 语法访问翻译文本。

**Section sources**
- [package.json](file://package.json#L12)
- [src/i18n/index.js](file://src/i18n/index.js#L1-L577)
- [src/main.js](file://src/main.js#L4)
- [src/components/MainView.vue](file://src/components/MainView.vue#L547-L548)

## 部署与开发配置

项目使用 **Docker** 进行容器化部署，通过 `docker-compose.yml` 文件定义了完整的开发环境。

该文件配置了两个主要服务：`postgres` 和 `pgadmin`。`postgres` 服务基于 `postgres:16-alpine` 镜像，将容器的5432端口映射到宿主机，用于运行PostgreSQL数据库。`pgadmin` 服务则提供了一个Web界面，方便开发者管理和查询数据库。文件中还详细注释了各服务的连接信息，如数据库的用户名、密码、数据库名以及pgAdmin的登录邮箱和密码，极大地简化了环境的搭建过程。

**Vite开发服务器配置** (`vite.config.js`) 的作用至关重要。它不仅启用了开发服务器，更重要的是通过 `server.proxy` 配置解决了前后端分离开发时的跨域问题。它将前端应用无法处理的API请求智能地转发到后端服务器，使得前端开发者可以专注于UI和交互，而无需关心后端服务的具体部署位置。

**Section sources**
- [docker-compose.yml](file://docker-compose.yml#L1-L51)
- [vite.config.js](file://vite.config.js#L1-L21)